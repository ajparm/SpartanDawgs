---
title: "K-means clustering V2"
author: "Arjun Parmar"
date: "2024-01-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Initialize Session

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(cluster)
library(plotly)
library(factoextra)
library(kableExtra)
library(missForest)
library(mice)

set.seed(69)

fangraphs_season_level <- read.csv("/Volumes/PARMARAR/Reds Hackathon/2024 Hackathon/fangraphs_season_level.csv")

```

## Normalize data

### Stats --\> Normalized to number of pitches

```{r}
raw_vars <- c("G","GS","IP","TBF","W","L","CG","ShO","SV","BS","HLD","SD","MD","Pulls","R","ER","H","HR","SO","BB","IBB","HBP","WP","BK","Events","GB","LD","FB","IFFB","BU","IFH","BUH","Balls","Strikes", "RS", "FRM", "maxEV")
              
norm_stats <- (fangraphs_season_level[, names(fangraphs_season_level) %in% raw_vars])/fangraphs_season_level$Pitches
```

### Add the adjusted stats

```{r}
adjusted_vars <- c("ERA", "RS_per_9","K_pct","BB_pct","K_minus_BB_pct","K_per_9","BB_per_9","K_to_BB","H_per_9","HR_per_9","AVG","WHIP","BABIP","LOB_pct","GB_pct","LD_pct","FB_pct","IFFB_pct","GB_to_FB","HR_to_FB","IFH_pct","BUH_pct","FIP","xFIP","SIERA","tERA","kwERA","E_minus_F","RAR","WAR","Dollars","WPA","RE24","REW","pLI","inLI","gmLI","exLI","WPA_to_LI","Clutch","OSwing_pct","ZSwing_pct","Swing_pct","OContact_pct","ZContact_pct","Contact_pct","Zone_pct","FStrike_pct","SwStr_pct","CStr_pct","CSW_pct","ERA_minus","FIP_minus","xFIP_minus","Pace","RA9_WAR","BIP_Wins","LOB_Wins","FDP_Wins","Pull_pct","Cent_pct","Oppo_pct","Soft_pct","Med_pct","Hard_pct","TTO_pct", "K_pct_plus","BB_pct_plus","K_per_9_plus","BB_per_9_plus","K_to_BB_plus","H_per_9_plus","HR_per_9_plus","AVG_plus","WHIP_plus","BABIP_plus","LOB_pct_plus","GB_pct_plus","LD_pct_plus","FB_pct_plus","HR_to_FB_pct_plus","Pull_pct_plus","Cent_pct_plus","Oppo_pct_plus","Med_pct_plus","Hard_pct_plus","EV","LA", "Barrel_pct","HardHit_pct","FA_pct","FAv","SL_pct","SLv","CT_pct","CTv","CB_pct","CBv","CH_pct","CHv","SF_pct","SFv","KN_pct","KNv","XX_pct","PO_pct","wFB_per_c","wSL_per_c","wCT_per_c","wCB_per_c","wCH_per_c","wSF_per_c","wKN_per_c", "FA_pct_sc","FC_pct_sc","FS_pct_sc","FO_pct_sc","SI_pct_sc","SL_pct_sc","CU_pct_sc","KC_pct_sc","EP_pct_sc","CH_pct_sc","SC_pct_sc","KN_pct_sc","UN_pct_sc","vFA_sc","vFC_sc","vFS_sc","vFO_sc","vSI_sc","vSL_sc","vCU_sc","vKC_sc","vEP_sc","vCH_sc","vSC_sc","vKN_sc","FA_X_sc","FC_X_sc","FS_X_sc","FO_X_sc","SI_X_sc","SL_X_sc","CU_X_sc","KC_X_sc","EP_X_sc","CH_X_sc","SC_X_sc","KN_X_sc","FA_Z_sc","FC_Z_sc","FS_Z_sc","FO_Z_sc","SI_Z_sc","SL_Z_sc","CU_Z_sc","KC_Z_sc","EP_Z_sc","CH_Z_sc","SC_Z_sc","KN_Z_sc","wFA_sc","wFC_sc","wFS_sc","wFO_sc","wSI_sc","wSL_sc","wCU_sc","wKC_sc","wEP_sc","wCH_sc","wSC_sc","wKN_sc","wFA_per_c_sc","wFC_per_c_sc","wFS_per_c_sc","wFO_per_c_sc","wSI_per_c_sc","wSL_per_c_sc","wCU_per_c_sc","wKC_per_c_sc","wEP_per_c_sc","wCH_per_c_sc","wSC_per_c_sc","wKN_per_c_sc","OSwing_pct_sc","ZSwing_pct_sc","Swing_pct_sc","OContact_pct_sc","ZContact_pct_sc","Contact_pct_sc","Zone_pct_sc", "botOvr","botStf","botCmd","Stuff_plus","Location_plus","Pitching_plus")
  
norm_stats <- cbind(norm_stats, (fangraphs_season_level[, names(fangraphs_season_level) %in% adjusted_vars]))
```

### Add the pitch arsenal count

```{r}
bot <- (fangraphs_season_level[, names(fangraphs_season_level) %in% c("botOvr_CH","botOvr_CU","botOvr_FA","botOvr_SI","botOvr_SL","botOvr_KC","botOvr_FC","botOvr_FS")])

bot$non_na_count <- rowSums(!is.na(bot))

pitch_plus <- (fangraphs_season_level[, names(fangraphs_season_level) %in% c("Pit_plus_CH","Pit_plus_CU","Pit_plus_FA","Pit_plus_SI","Pit_plus_SL","Pit_plus_KC","Pit_plus_FC","Pit_plus_FS", "Pit_plus_FO")])

pitch_plus$non_na_count <- rowSums(!is.na(bot))

pitch_arsenal <- as.data.frame(cbind(bot$non_na_count,pitch_plus$non_na_count))
colnames(pitch_arsenal) <- c("bot_count", "pitch_plus_count")
  
norm_stats <- cbind(norm_stats,pitch_arsenal)

rm(bot, pitch_plus,pitch_arsenal)
```

### Normalize to season

normalized stat = actual statÂ  + ((actual stat - min stat) \* (league average stat for that year))

```{r message=FALSE, warning=FALSE}
with_season <- cbind(fangraphs_season_level$Season, norm_stats) 
colnames(with_season) <- c("season",names(with_season)[-1])

twenty_one <- with_season %>% filter(as.character(with_season[,1]) == 2021)
normalized_21 <- data.frame(matrix(nrow = nrow(twenty_one), ncol = ncol(twenty_one)))
colnames(normalized_21) <- colnames(twenty_one)
for (col in names(twenty_one)) {
  column_values <- twenty_one[[col]]
  normalized_values <- column_values + 
                            ((column_values - min(column_values, na.rm = TRUE)) 
                                    * mean(column_values, na.rm = TRUE))
  normalized_21[[col]] <- normalized_values
}

twenty_two <-  with_season %>% filter(as.character(with_season[,1]) == 2022)
normalized_22 <- data.frame(matrix(nrow = nrow(twenty_two), ncol = ncol(twenty_two)))
colnames(normalized_22) <- colnames(twenty_two)
for (col in names(twenty_two)) {
  column_values <- twenty_two[[col]]
  normalized_values <- column_values + 
                            ((column_values - min(column_values, na.rm = TRUE)) 
                                    * mean(column_values, na.rm = TRUE))
  normalized_22[[col]] <- normalized_values
}

twenty_three <-  with_season %>% filter(as.character(with_season[,1]) == 2023)
normalized_23 <- data.frame(matrix(nrow = nrow(twenty_three), ncol = ncol(twenty_three)))
colnames(normalized_23) <- colnames(twenty_three)
for (col in names(twenty_three)) {
  column_values <- twenty_three[[col]]
  normalized_values <- column_values + 
                            ((column_values - min(column_values, na.rm = TRUE)) 
                                    * mean(column_values, na.rm = TRUE))
  normalized_23[[col]] <- normalized_values
}

normalized_dataset <- rbind(normalized_23, normalized_22, normalized_21)[-1]
rm(normalized_23, normalized_22, normalized_21)
```

### Add age

```{r}
normalized_dataset$Age <- fangraphs_season_level$Age
```

## Data clean up

### Assess missing values

```{r}
for (col_name in names(normalized_dataset)) {
  na_count <- sum(is.na(normalized_dataset[[col_name]]))
  if (na_count != 0) {
    cat(col_name, ":", na_count, "\n")
  }
}
```

## K Means Analysis

### Remove columns with NA values

```{r}
#remove na columns
normalized_dataset_na <- normalized_dataset[, colSums(is.na(normalized_dataset)) == 0]

```

#### Raw

```{r}
#Optimal cluster number
tot.withinss <- vector(mode="character", length=10)
for (i in 1:10){
  Cluster <- kmeans(normalized_dataset_na, center=i, nstart=20, iter.max = 100)
  tot.withinss[i] <- Cluster$tot.withinss
}
plot(1:10, tot.withinss[1:10], type="b", pch=19)


# Perform the k-means clustering
Cluster_raw <- kmeans(normalized_dataset_na, centers = 3, nstart = 20, iter.max = 20)


#Plot RAW clusters
pca_result <- prcomp(normalized_dataset_na, scale. = TRUE)
pcs <- pca_result$x[, 1:3]
plot_3d <- plot_ly(x = pcs[, 1], y = pcs[, 2], z = pcs[, 3], 
                   type = "scatter3d", mode = "markers", 
                   marker = list(color = Cluster_raw$cluster))
plot_3d <- plot_3d %>%
  layout(scene = list(
    xaxis = list(title = "PC 1"),
    yaxis = list(title = "PC 2"),
    zaxis = list(title = "PC 3")),
  title = paste0("RAW: 3D PCA Cluster Plot (", 
                 round(sum(summary(pca_result)$importance[3, ][1:3])*100, 2),
                 "%)"))
plot_3d


# Max and Min stats
max <- t(as.data.frame(apply(Cluster_raw[["centers"]], 2, which.max)))
min <- t(as.data.frame(apply(Cluster_raw[["centers"]], 2, which.min)))
data <- list(
  one_max = colnames(max)[apply(max == 1, 2, any)],
  two_max = colnames(max)[apply(max == 2, 2, any)],
  three_max = colnames(max)[apply(max == 3, 2, any)],
  one_min = colnames(min)[apply(min == 1, 2, any)],
  two_min = colnames(min)[apply(min == 2, 2, any)],
  three_min = colnames(min)[apply(min == 3, 2, any)]
)
max_row_length <- max(sapply(data, length))
padded_data <- lapply(data, function(x) c(x, rep(NA, max_row_length - length(x))))
df <- data.frame(padded_data)
df


# Pitching Roles 
clusterd_data <- cbind(normalized_dataset_na,as.data.frame(Cluster_raw$cluster))
players_groups <- cbind(Cluster_raw$cluster, fangraphs_season_level$PlayerId, fangraphs_season_level$Season, fangraphs_season_level$Role)
colnames(players_groups) <- c('group', 'playerid', 'szn', 'Role')
rp <- as.data.frame(players_groups) %>% filter(Role == "RP") 
sp <- as.data.frame(players_groups) %>% filter(Role == "SP") 


par(mfrow = c(2, 1))
hist(as.numeric(rp$group), breaks = 3, xlim = c(1,3), main = "RP")
hist(as.numeric(sp$group), breaks = 3, xlim = c(1,3), main = "SP")
```

#### Scaled

```{r}
normalized_dataset_na_scaled <- scale(normalized_dataset_na)


#Optimal cluster number
tot.withinss <- vector(mode="character", length=10)
for (i in 1:10){
  Cluster <- kmeans(normalized_dataset_na_scaled, center=i, nstart=20, iter.max = 100)
  tot.withinss[i] <- Cluster$tot.withinss
}
plot(1:10, tot.withinss[1:10], type="b", pch=19)


# Perform the k-means clustering
Cluster_scaled <- kmeans(normalized_dataset_na_scaled, centers = 3, nstart = 20, iter.max = 20)


#Plot SCALED clusters
pca_result <- prcomp(normalized_dataset_na_scaled, scale. = F)
pcs <- pca_result$x[, 1:3]
plot_3d <- plot_ly(x = pcs[, 1], y = pcs[, 2], z = pcs[, 3], 
                   type = "scatter3d", mode = "markers", 
                   marker = list(color = Cluster_scaled$cluster))
plot_3d <- plot_3d %>%
  layout(scene = list(
    xaxis = list(title = "PC 1"),
    yaxis = list(title = "PC 2"),
    zaxis = list(title = "PC 3")),
  title = paste0("RAW: 3D PCA Cluster Plot (", 
                 round(sum(summary(pca_result)$importance[3, ][1:3])*100, 2),
                 "%)"))
plot_3d


# Max and Min stats
max <- t(as.data.frame(apply(Cluster_scaled[["centers"]], 2, which.max)))
min <- t(as.data.frame(apply(Cluster_scaled[["centers"]], 2, which.min)))
data <- list(
  one_max = colnames(max)[apply(max == 1, 2, any)],
  two_max = colnames(max)[apply(max == 2, 2, any)],
  three_max = colnames(max)[apply(max == 3, 2, any)],
  one_min = colnames(min)[apply(min == 1, 2, any)],
  two_min = colnames(min)[apply(min == 2, 2, any)],
  three_min = colnames(min)[apply(min == 3, 2, any)]
)
max_row_length <- max(sapply(data, length))
padded_data <- lapply(data, function(x) c(x, rep(NA, max_row_length - length(x))))
df <- data.frame(padded_data)
df


# Pitching Roles 
clusterd_data <- cbind(normalized_dataset_na_scaled,as.data.frame(Cluster_scaled$cluster))
players_groups <- cbind(Cluster_scaled$cluster, fangraphs_season_level$PlayerId, fangraphs_season_level$Season, fangraphs_season_level$Role)
colnames(players_groups) <- c('group', 'playerid', 'szn', 'Role')
rp <- as.data.frame(players_groups) %>% filter(Role == "RP") 
sp <- as.data.frame(players_groups) %>% filter(Role == "SP") 


par(mfrow = c(2, 1))
hist(as.numeric(rp$group), breaks = 3, xlim = c(1,3), main = "RP")
hist(as.numeric(sp$group), breaks = 3, xlim = c(1,3), main = "SP")
```

### Impute missing values of select columns

```{r}

missingness_threshold <- .05 * nrow(normalized_dataset) #max number of missing values 


selected_normalized_dataset <- normalized_dataset[names(colSums(is.na(normalized_dataset))[colSums(is.na(normalized_dataset)) < missingness_threshold])]

```

#### Lasso regression imputation

```{r}
#This takes a while
#imputed_lasso <- complete(mice(selected_normalized_dataset, method = "lasso.norm"))


# Print the missing values 
for (col_name in names(imputed_lasso)) {
  na_count <- sum(is.na(imputed_lasso[[col_name]]))
  if (na_count != 0) {
    cat(col_name, ":", na_count, "\n")
  }
}


# Remove columns with NAs
imputed_lasso <- imputed_lasso[, colSums(is.na(imputed_lasso)) == 0]


# Scaled
imputed_lasso_scaled <- scale(imputed_lasso)
```

##### Raw

```{r}
#Optimal cluster number
tot.withinss <- vector(mode="character", length=10)
for (i in 1:10){
  Cluster <- kmeans(imputed_lasso, center=i, nstart=20, iter.max = 100)
  tot.withinss[i] <- Cluster$tot.withinss
}
plot(1:10, tot.withinss[1:10], type="b", pch=19)



Cluster_lasso_impute <- kmeans(imputed_lasso, centers = 3, nstart = 20, iter.max = 20)


# Plot the clusters 
pca_result <- prcomp(imputed_lasso, scale. = TRUE)
pcs <- pca_result$x[, 1:3]
plot_3d <- plot_ly(x = pcs[, 1], y = pcs[, 2], z = pcs[, 3], 
                   type = "scatter3d", mode = "markers", 
                   marker = list(color = Cluster_lasso_impute$cluster))
plot_3d <- plot_3d %>%
  layout(scene = list(
    xaxis = list(title = "PC 1"),
    yaxis = list(title = "PC 2"),
    zaxis = list(title = "PC 3")
  ),
  title = paste0("3D PCA Cluster Plot (", 
                 round(sum(summary(pca_result)$importance[3, ][1:3])*100, 2),
                 "%)"))
plot_3d


# Pitcher role 
clusterd_data <- cbind(imputed_lasso,Cluster_lasso_impute$cluster)
players_groups <- cbind(clusterd_data$`Cluster_lasso_impute$cluster`, fangraphs_season_level$PlayerId, fangraphs_season_level$Season, fangraphs_season_level$Role)
colnames(players_groups) <- c('group', 'playerid', 'szn', 'Role')
rp <- as.data.frame(players_groups) %>% filter(Role == "RP") 
sp <- as.data.frame(players_groups) %>% filter(Role == "SP") 
par(mfrow = c(2, 1))
hist(as.numeric(rp$group), breaks = 3, xlim = c(1,3), main = "RP")
hist(as.numeric(sp$group), breaks = 3, xlim = c(1,3), main = "SP")




# Stat max min 
max <- t(as.data.frame(apply(Cluster_lasso_impute[["centers"]], 2, which.max)))
min <- t(as.data.frame(apply(Cluster_lasso_impute[["centers"]], 2, which.min)))
data <- list(
  one_max = colnames(max)[apply(max == 1, 2, any)],
  two_max = colnames(max)[apply(max == 2, 2, any)],
  three_max = colnames(max)[apply(max == 3, 2, any)],
  
  one_min = colnames(min)[apply(min == 1, 2, any)],
  two_min = colnames(min)[apply(min == 2, 2, any)],
  three_min = colnames(min)[apply(min == 3, 2, any)]
)
max_row_length <- max(sapply(data, length))
padded_data <- lapply(data, function(x) c(x, rep(NA, max_row_length - length(x))))
df <- data.frame(padded_data)
print(df)

```

##### Scaled

```{r}
#Optimal cluster number
tot.withinss <- vector(mode="character", length=10)
for (i in 1:10){
  Cluster <- kmeans(imputed_lasso_scaled, center=i, nstart=20, iter.max = 100)
  tot.withinss[i] <- Cluster$tot.withinss
}
plot(1:10, tot.withinss[1:10], type="b", pch=19)



Cluster_lasso_impute_scaled <- kmeans(imputed_lasso_scaled, centers = 3, nstart = 20, iter.max = 20)


# Plot the clusters 
pca_result <- prcomp(imputed_lasso_scaled, scale. = F)
pcs <- pca_result$x[, 1:3]
plot_3d <- plot_ly(x = pcs[, 1], y = pcs[, 2], z = pcs[, 3], 
                   type = "scatter3d", mode = "markers", 
                   marker = list(color = Cluster_lasso_impute_scaled$cluster))
plot_3d <- plot_3d %>%
  layout(scene = list(
    xaxis = list(title = "PC 1"),
    yaxis = list(title = "PC 2"),
    zaxis = list(title = "PC 3")
  ),
  title = paste0("3D PCA Cluster Plot (", 
                 round(sum(summary(pca_result)$importance[3, ][1:3])*100, 2),
                 "%)"))
plot_3d



# Pitcher role 
clusterd_data <- cbind(imputed_lasso_scaled,Cluster_lasso_impute_scaled$cluster)
players_groups <- cbind(Cluster_lasso_impute_scaled$cluster, fangraphs_season_level$PlayerId, fangraphs_season_level$Season, fangraphs_season_level$Role)
colnames(players_groups) <- c('group', 'playerid', 'szn', 'Role')
rp <- as.data.frame(players_groups) %>% filter(Role == "RP") 
sp <- as.data.frame(players_groups) %>% filter(Role == "SP") 
par(mfrow = c(2, 1))
hist(as.numeric(rp$group), breaks = 3, xlim = c(1,3), main = "RP")
hist(as.numeric(sp$group), breaks = 3, xlim = c(1,3), main = "SP")




# Stat max min 
max <- t(as.data.frame(apply(Cluster_lasso_impute_scaled[["centers"]], 2, which.max)))
min <- t(as.data.frame(apply(Cluster_lasso_impute_scaled[["centers"]], 2, which.min)))
data <- list(
  one_max = colnames(max)[apply(max == 1, 2, any)],
  two_max = colnames(max)[apply(max == 2, 2, any)],
  three_max = colnames(max)[apply(max == 3, 2, any)],
  
  one_min = colnames(min)[apply(min == 1, 2, any)],
  two_min = colnames(min)[apply(min == 2, 2, any)],
  three_min = colnames(min)[apply(min == 3, 2, any)]
)
max_row_length <- max(sapply(data, length))
padded_data <- lapply(data, function(x) c(x, rep(NA, max_row_length - length(x))))
df <- data.frame(padded_data)
print(df)

```

#### Random Forest imputation

```{r}
#This takes a while
#imputed_rf <- complete(mice(selected_normalized_dataset, method = "rf"))


# Print the missing values 
for (col_name in names(imputed_rf)) {
  na_count <- sum(is.na(imputed_rf[[col_name]]))
  if (na_count != 0) {
    cat(col_name, ":", na_count, "\n")
  }
}



# Remove columns with NAs
imputed_rf <- imputed_rf[, colSums(is.na(imputed_rf)) == 0]


# Scaled
imputed_rf_scaled <- scale(imputed_rf)
```

##### Raw

```{r}

Cluster_rf_impute <- kmeans(imputed_rf, centers = 3, nstart = 20, iter.max = 20)



# Plot
pca_result <- prcomp(imputed_rf, scale. = TRUE)
pcs <- pca_result$x[, 1:3]
plot_3d <- plot_ly(x = pcs[, 1], y = pcs[, 2], z = pcs[, 3], 
                   type = "scatter3d", mode = "markers", 
                   marker = list(color = Cluster_rf_impute$cluster))
plot_3d <- plot_3d %>%
  layout(scene = list(
    xaxis = list(title = "PC 1"),
    yaxis = list(title = "PC 2"),
    zaxis = list(title = "PC 3")
  ),
  title = paste0("3D PCA Cluster Plot (", 
                 round(sum(summary(pca_result)$importance[3, ][1:3])*100, 2),
                 "%)"))
plot_3d



# Pitcher role 
clusterd_data <- cbind(imputed_rf,Cluster_rf_impute$cluster)
players_groups <- cbind(Cluster_rf_impute$cluster, fangraphs_season_level$PlayerId, fangraphs_season_level$Season, fangraphs_season_level$Role)
colnames(players_groups) <- c('group', 'playerid', 'szn', 'Role')
rp <- as.data.frame(players_groups) %>% filter(Role == "RP") 
sp <- as.data.frame(players_groups) %>% filter(Role == "SP") 
par(mfrow = c(2, 1))
hist(as.numeric(rp$group), breaks = 3, xlim = c(1,3), main = "RP")
hist(as.numeric(sp$group), breaks = 3, xlim = c(1,3), main = "SP")



# Stat max min 
max <- t(as.data.frame(apply(Cluster_rf_impute[["centers"]], 2, which.max)))
min <- t(as.data.frame(apply(Cluster_rf_impute[["centers"]], 2, which.min)))
data <- list(
  one_max = colnames(max)[apply(max == 1, 2, any)],
  two_max = colnames(max)[apply(max == 2, 2, any)],
  three_max = colnames(max)[apply(max == 3, 2, any)],
  one_min = colnames(min)[apply(min == 1, 2, any)],
  two_min = colnames(min)[apply(min == 2, 2, any)],
  three_min = colnames(min)[apply(min == 3, 2, any)]
)
max_row_length <- max(sapply(data, length))
padded_data <- lapply(data, function(x) c(x, rep(NA, max_row_length - length(x))))
df <- data.frame(padded_data)
df


```

##### Scaled

```{r}

Cluster_rf_impute_scaled <- kmeans(imputed_rf_scaled, centers = 3, nstart = 20, iter.max = 20)



# Plot
pca_result <- prcomp(imputed_rf_scaled, scale. = F)
pcs <- pca_result$x[, 1:3]
plot_3d <- plot_ly(x = pcs[, 1], y = pcs[, 2], z = pcs[, 3], 
                   type = "scatter3d", mode = "markers", 
                   marker = list(color = Cluster_rf_impute_scaled$cluster))
plot_3d <- plot_3d %>%
  layout(scene = list(
    xaxis = list(title = "PC 1"),
    yaxis = list(title = "PC 2"),
    zaxis = list(title = "PC 3")
  ),
  title = paste0("3D PCA Cluster Plot (", 
                 round(sum(summary(pca_result)$importance[3, ][1:3])*100, 2),
                 "%)"))
plot_3d



# Pitcher role 
clusterd_data <- cbind(imputed_rf_scaled,Cluster_rf_impute_scaled$cluster)
players_groups <- cbind(Cluster_rf_impute_scaled$cluster, fangraphs_season_level$PlayerId, fangraphs_season_level$Season, fangraphs_season_level$Role)
colnames(players_groups) <- c('group', 'playerid', 'szn', 'Role')
rp <- as.data.frame(players_groups) %>% filter(Role == "RP") 
sp <- as.data.frame(players_groups) %>% filter(Role == "SP") 
par(mfrow = c(2, 1))
hist(as.numeric(rp$group), breaks = 3, xlim = c(1,3), main = "RP")
hist(as.numeric(sp$group), breaks = 3, xlim = c(1,3), main = "SP")



# Stat max min 
max <- t(as.data.frame(apply(Cluster_rf_impute_scaled[["centers"]], 2, which.max)))
min <- t(as.data.frame(apply(Cluster_rf_impute_scaled[["centers"]], 2, which.min)))
data <- list(
  one_max = colnames(max)[apply(max == 1, 2, any)],
  two_max = colnames(max)[apply(max == 2, 2, any)],
  three_max = colnames(max)[apply(max == 3, 2, any)],
  one_min = colnames(min)[apply(min == 1, 2, any)],
  two_min = colnames(min)[apply(min == 2, 2, any)],
  three_min = colnames(min)[apply(min == 3, 2, any)]
)
max_row_length <- max(sapply(data, length))
padded_data <- lapply(data, function(x) c(x, rep(NA, max_row_length - length(x))))
df <- data.frame(padded_data)
df


```
